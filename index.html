<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/red/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"gyhaoran.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"changyan","storage":true,"lazyload":false,"nav":null,"activeClass":"changyan"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Leo&#39;s Blog">
<meta property="og:url" content="https://gyhaoran.github.io/index.html">
<meta property="og:site_name" content="Leo&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leo Ge">
<meta property="article:tag" content="Linux, C++">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://gyhaoran.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Leo's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Leo's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">保持谦逊，终身学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fa fa-book fa-fw"></i>留言板</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leo Ge"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">Leo Ge</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2024/06/06/ray-job/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/06/ray-job/" class="post-title-link" itemprop="url">Ray Job Management</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-06 21:49:29" itemprop="dateCreated datePublished" datetime="2024-06-06T21:49:29+08:00">2024-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-20 08:44:51" itemprop="dateModified" datetime="2024-08-20T08:44:51+08:00">2024-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ray/" itemprop="url" rel="index"><span itemprop="name">ray</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Ray Job Management" href="/2024/06/06/ray-job/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::b9ce3bb8c9d757f89884ce42afc987d3" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Ray-如何提交-Job"><a href="#Ray-如何提交-Job" class="headerlink" title="Ray 如何提交 Job"></a>Ray 如何提交 Job</h2><p><img src="/2024/06/06/ray-job/ray-job.png" alt="ray job"></p>
<p>在 Ray 中，Actor 和 Task 是归属于一个 Job 的，所以要运行真正的 code，需要提交 Job。Job 提交的时候可以通过** CLI、Python SDK、或者 REST API <strong>去提交，</strong>提交的入口是 Head 节点**。</p>
<p>Head 节点中有 Job 提交的 api 服务。在提交了 Job 之后<strong>，Head 节点中的 Driver 会去创建 Actor 这个特殊类型的 Task，以及 Function 类型的 Task</strong>，之后调度到 Worker 节点中，由 <strong>Worker process</strong> 去运行这些 Task，这中间还会涉及到调度等能力，不在这里细化。</p>
<h2 id="1-Ray-Jobs-CLI"><a href="#1-Ray-Jobs-CLI" class="headerlink" title="1 Ray Jobs CLI"></a>1 Ray Jobs CLI</h2><h3 id="1-1-启动ray集群"><a href="#1-1-启动ray集群" class="headerlink" title="1.1 启动ray集群"></a>1.1 启动ray集群</h3><ul>
<li><p>启动head节点</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ray start --<span class="built_in">head</span> --num-cpus=1 --num-gpus=0 --resources=<span class="string">&#x27;&#123;&quot;CustomResource&quot;: 2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在这个命令中，**–num-cpus和–num-gpu**s分别指定了head节点的CPU和GPU数量 ，–resources标志用于指定自定义资源</p>
</li>
<li><p>启动worker节点</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ray start --address=<span class="string">&#x27;&lt;head_node_ip&gt;:&lt;port&gt;&#x27;</span> --num-cpus=4 --num-gpus=0 --resources=<span class="string">&#x27;&#123;&quot;CustomResource&quot;: 2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在这个命令中，**–address指定了head节点的IP地址和端口**。</p>
</li>
</ul>
<h3 id="1-2-提交任务"><a href="#1-2-提交任务" class="headerlink" title="1.2 提交任务"></a>1.2 提交任务</h3><ul>
<li><p>ray submit 提交任务</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ray submit my_job.py --num-cpus=2 --num-gpus=1</span><br></pre></td></tr></table></figure>
<p>这里将使用my_job.py作为入口点，并为作业指定了2个CPU核心和1个GPU。</p>
</li>
<li><p>ray job submit 提交任务</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ray job submit --working-dir your_working_directory -- python script.py</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-3-查看集群和任务状态"><a href="#1-3-查看集群和任务状态" class="headerlink" title="1.3 查看集群和任务状态"></a>1.3 查看集群和任务状态</h3><h4 id="1-3-1-通过DashBoard查看状态"><a href="#1-3-1-通过DashBoard查看状态" class="headerlink" title="1.3.1 通过DashBoard查看状态"></a>1.3.1 通过DashBoard查看状态</h4><p><img src="/2024/06/06/ray-job/ray-dashborad.png" alt="ray dashborad"></p>
<ul>
<li>可以在<strong>Jobs</strong>页面查看单个任务的运行情况，包括当前<strong>任务状态</strong>（PENDING, RUNNING, SUCCEED, FAILED），<strong>任务日志</strong>, 任务的启动时间和运行时间等等</li>
<li>可以在<strong>Cluster</strong>页面查看查看集群结点的状态，包含<strong>CPU和MEM的使用情况</strong>等等</li>
</ul>
<h4 id="1-3-2-通过命令行查询状态"><a href="#1-3-2-通过命令行查询状态" class="headerlink" title="1.3.2 通过命令行查询状态"></a>1.3.2 通过命令行查询状态</h4><ul>
<li><p>使用** ray status** 命令可以查看当前集群的状态的概要信息。</p>
<p>  <img src="/2024/06/06/ray-job/status.png" alt="ray status"></p>
</li>
<li><p>查看node、job等信息：ray list命令可以显示具体信息</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ray list nodes：  <span class="comment"># 列出当前 Ray 集群中所有节点的信息，包括节点的 ID、IP 地址、端口号、资源等。 </span></span><br><span class="line">ray list <span class="built_in">jobs</span>     <span class="comment"># 列出当前 Ray 集群中所有作业（jobs）的信息，包括作业的 ID、状态、创建时间等。 </span></span><br><span class="line">ray list workers：<span class="comment"># 列出当前 Ray 集群中所有 worker 的信息，包括 worker 的 ID、节点 ID、PID、状态等。 </span></span><br><span class="line">ray list tasks    <span class="comment"># 列出当前 Ray 集群中所有任务（tasks）的信息，包括任务的名称（function/class name)、 ID、状态、所属的job和node id创建时间等。</span></span><br></pre></td></tr></table></figure>
<p>可以在各个子命令后加上 –limit n限制显示的条数，–detail显示详细信息</p>
</li>
<li><p>ray list jobs显示情况<br>  <img src="/2024/06/06/ray-job/list_jobs.png" alt="list_jobs"><br>图中，通过<strong>Status字段可以可到每个job的状态</strong>，包括失败、正在运行以及等待的任务，还有任务失败和等待的原因（<strong>MESSAGE字段</strong>）</p>
</li>
</ul>
<h3 id="1-4-取消任务"><a href="#1-4-取消任务" class="headerlink" title="1.4 取消任务"></a>1.4 取消任务</h3><ul>
<li><p>使用ray job的子命令stop取消指定job</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ray job stop &lt;jobsub-id&gt;</span><br></pre></td></tr></table></figure>
<p>  <img src="/2024/06/06/ray-job/stop.png" alt="ray job stop"></p>
</li>
<li><p>ray job子命令：ray job COMMAND [ARGS] Commands:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delete  Deletes a stopped job and its associated data from memory.</span><br><span class="line">list    Lists all running <span class="built_in">jobs</span> and their information.</span><br><span class="line">logs    Gets the logs of a job.</span><br><span class="line">status  Queries <span class="keyword">for</span> the current status of a job.</span><br><span class="line">stop    Attempts to stop a job.</span><br><span class="line">submit  Submits a job to be run on the cluster.</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-Ray-Python-SDK"><a href="#2-Ray-Python-SDK" class="headerlink" title="2 Ray Python SDK"></a>2 Ray Python SDK</h2><h3 id="2-1-remote装饰器"><a href="#2-1-remote装饰器" class="headerlink" title="2.1 remote装饰器"></a>2.1 remote装饰器</h3><ul>
<li><p>你可以使用ray.remote装饰器来定义可以并行执行的任务，然后使用ray.get或ray.wait来获取任务的结果。</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ray </span><br><span class="line"></span><br><span class="line">ray.init() <span class="comment"># 启动ray集群 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ray.remote </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_function</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * x </span><br><span class="line"></span><br><span class="line"><span class="comment">### submit job </span></span><br><span class="line">result_refs = [my_function.remote(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] </span><br><span class="line"></span><br><span class="line"><span class="comment">### 获取运行结果 </span></span><br><span class="line">result = [ray.get(i) <span class="keyword">for</span> i <span class="keyword">in</span> result_refs]</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定资源 你可以通过@ray.remote装饰器的参数来指定资源信息，例如：</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ray.remote(<span class="params">num_cpus=<span class="number">2</span>, num_gpus=<span class="number">0</span>, memory=<span class="number">1024</span></span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_function</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * x</span><br></pre></td></tr></table></figure></li>
</ul>
<p>在这个示例中，num_cpus用于指定CPU数量，num_gpus用于指定GPU数量，memory用于指定内存大小。</p>
<h3 id="2-2-JobSubmissionClient提交任务"><a href="#2-2-JobSubmissionClient提交任务" class="headerlink" title="2.2 JobSubmissionClient提交任务"></a>2.2 JobSubmissionClient提交任务</h3><ul>
<li>Using Ray Jobs API (Python SDK)  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ray.job_submission <span class="keyword">import</span> JobSubmissionClient</span><br><span class="line"></span><br><span class="line">client = JobSubmissionClient(<span class="string">&quot;http://&lt;head-node-ip&gt;:8265&quot;</span>)</span><br><span class="line">job_id = client.submit_job(</span><br><span class="line">    entrypoint=<span class="string">&quot;python my_ray_script.py&quot;</span>,</span><br><span class="line">    runtime_env=runtime_env,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-3-查看集群和任务状态"><a href="#2-3-查看集群和任务状态" class="headerlink" title="2.3 查看集群和任务状态"></a>2.3 查看集群和任务状态</h3><ul>
<li><p>获取集群所有资源<br>cluster_resources &#x3D; ray.cluster_resources()</p>
</li>
<li><p>获取当前可用的资源<br>available_resources &#x3D; ray.available_resources()</p>
</li>
<li><p>获取node、job等信息</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nodes = ray.state.nodes() </span><br><span class="line">jobs = ray.state.jobs() </span><br><span class="line">workers = ray.state.workers() </span><br><span class="line">actors = ray.state.actors()</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-4-取消任务"><a href="#2-4-取消任务" class="headerlink" title="2.4 取消任务"></a>2.4 取消任务</h3><ul>
<li><p>使用ray.cancel取消</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ray.remote</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long_running_task</span>():</span><br><span class="line">    <span class="comment"># 这里是任务代码</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交任务</span></span><br><span class="line">task = long_running_task.remote()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消任务</span></span><br><span class="line">ray.cancel(task)</span><br></pre></td></tr></table></figure>
</li>
<li><p>JobSubmissionClient方式</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ray.job_submission <span class="keyword">import</span> JobSubmissionClient </span><br><span class="line"></span><br><span class="line">client = JobSubmissionClient(<span class="string">&quot;http://127.0.0.1:8265&quot;</span>) </span><br><span class="line"></span><br><span class="line">sub_id = client.submit_job(entrypoint=<span class="string">&quot;sleep 10&quot;</span>) </span><br><span class="line"></span><br><span class="line">client.stop_job(sub_id)</span><br></pre></td></tr></table></figure>
</li>
<li><p>任务管理Client <strong>JobSubmissionClient API列表</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JobSubmissionClient.submit_job:      Submit <span class="keyword">and</span> execute a job asynchronously.</span><br><span class="line">JobSubmissionClient.stop_job:        Request a job to exit asynchronously.</span><br><span class="line">JobSubmissionClient.get_job_status： Get the most recent status of a job.</span><br><span class="line">JobSubmissionClient.get_job_info：   Get the latest status <span class="keyword">and</span> other information associated <span class="keyword">with</span> a job.</span><br><span class="line">JobSubmissionClient.list_jobs：      <span class="type">List</span> <span class="built_in">all</span> jobs along <span class="keyword">with</span> their status <span class="keyword">and</span> other information.</span><br><span class="line">JobSubmissionClient.get_job_logs：   Get <span class="built_in">all</span> logs produced by a job.</span><br><span class="line">JobSubmissionClient.tail_job_logs:   Get an iterator that follows the logs of a job.</span><br><span class="line">JobSubmissionClient.delete_job：     Delete a job <span class="keyword">in</span> a terminal state <span class="keyword">and</span> <span class="built_in">all</span> of its associated data.</span><br></pre></td></tr></table></figure>
</li>
<li><p>API遗留问题</p>
<p>  这里ray<code>JobSubmissionClient.stop_job</code>接口，对于PENDING的任务无法停止或者取消，这里也不能说是问题，但是ray应该加一个<strong>cancel的接口</strong>专门用来停止PENDING的job，多说一下，通过<strong>JobSubmissionClient</strong>接口提交的任务，在ray的底层都会创建一个<strong>ActorHandler</strong>对象用来运行任务，<strong>PENDING</strong>的任务，一般来说就是node资源不足或者环境不满足需求，无法被调度，所有stop的方法也无法被调度。</p>
<p>  <img src="/2024/06/06/ray-job/pending-actor.png" alt="ray pending actor"></p>
<ul>
<li>一种规避ray这个问题的方法，打补丁<br>在ray的底层获得<code>ActorHandler</code> 对象，通过ray.kill的方式取消这个Actor即可。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ray  底层源码</span></span><br><span class="line">stopped = self.get_job_manager().stop_job(job.submission_id)</span><br><span class="line">resp = JobStopResponse(stopped=stopped)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改后的源码</span></span><br><span class="line">status = self.get_job_manager().get_job_status(job.submission_id)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">str</span>(status) == <span class="string">&#x27;PENDING&#x27;</span>:</span><br><span class="line">    logger.warning(<span class="string">&#x27;pending job using ray.kill to stop&#x27;</span>)</span><br><span class="line">    ray.kill(self.get_job_manager()._get_actor_for_job(job.submission_id))</span><br><span class="line">    stopped =<span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    stopped = self.get_job_manager().stop_job(job.submission_id)</span><br><span class="line">resp = JobStopResponse(stopped=stopped)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2024/05/03/ray-autoscaler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/03/ray-autoscaler/" class="post-title-link" itemprop="url">Ray AutoScaler Introduction</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-03 21:49:29" itemprop="dateCreated datePublished" datetime="2024-05-03T21:49:29+08:00">2024-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-20 08:44:51" itemprop="dateModified" datetime="2024-08-20T08:44:51+08:00">2024-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ray/" itemprop="url" rel="index"><span itemprop="name">ray</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Ray AutoScaler Introduction" href="/2024/05/03/ray-autoscaler/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d4dcadb4ffe068435edbd04d9076e61a" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h2><p><strong>Autoscaler</strong>：基于集群的资源的使用情况，以及 job 对资源的需求，去增加和移除集群的节点。</p>
<h2 id="2-Autoscaler-能力"><a href="#2-Autoscaler-能力" class="headerlink" title="2 Autoscaler 能力"></a>2 Autoscaler 能力</h2><p>GCS 负责保证所有的 raylets 有最新的集群资源使用的视图。这样分布式调度器就可以更有效的完成调度， 如果这个视图是不够新的，那就可能会给分布式调度器造成调度不准确的问题，导致 actors&#x2F;tasks 不能很好的被调度到合适的位置。 默认，<strong>GCS 会每隔 100ms 从所有的注册到自己的 raylets 去拉取最新的资源使用情况的视图，也会间隔 100ms 去广播给其它的 raylets。</strong> 同时 GCS 也会为 Autoscaler 组件提供当前集群的负载的数据，以帮助 Autoscaler 去判断什么时候给集群增加机器和从集群中移除机器。</p>
<p><img src="/2024/05/03/ray-autoscaler/autoscaler.png" alt="ray autoscaler"></p>
<p>Ray Autoscaler 负责从集群中添加和删除节点。它查看分布式调度器公开的逻辑资源需求、集群中当前的节点、集群的节点配置文件， 计算所需的集群配置，并执行将集群移动到所需状态的操作。<strong>Autoscaler 会从 GCS 中去拉取当前集群的负载情况，然后调用云厂商的实现去添加和移除节点。</strong></p>
<hr>
<p><strong>自动扩缩容的主要工作包含以下几点</strong>：</p>
<ul>
<li><p>当应用提交 actors、tasks、placement groups 去请求资源，如 CPU、GPU 等。</p>
</li>
<li><p>调度器会查看资源的要求和可用的资源，然后决定 tasks 应该放置的位置，或者<strong>资源不满足的时候就会阻塞，这个信息会被作为一个快照放到 GCS 中</strong>。</p>
</li>
<li><p>Autoscaler 作为一个独立的进程运行，<strong>它周期性地从 GCS 中抓取步骤 2 中提到的快照</strong>， 然后从中查看集群的可用资源、请求的资源、有什么 tasks 是阻塞的，以及 worker 节点被设置的配置， <strong>然后运行bin-packing 算法（下面第3节有介绍）</strong>去计算一下，在能保证运行中的 tasks&#x2F;actors&#x2F;placement group 和阻塞的这些 tasks&#x2F;actors&#x2F;placement group 的资源都能满足的情况下，一共需要多少节点。</p>
</li>
<li><p>然后 Autoscaler 使用 node provider interface 去添加和移除节点，<strong>各种 cloud provider 可以去实现自己的 node provider interface</strong>，如 AWS、 GCP、Azure、Kubernetes 以及 on-premise 的数据中心。（也包括LSF和Slurm）</p>
</li>
<li><p>当新的节点启动了，也注册到 Ray 的集群中了，这些节点就可以接收应用的工作负载了。</p>
</li>
</ul>
<h2 id="3-调度能力"><a href="#3-调度能力" class="headerlink" title="3 调度能力"></a>3 调度能力</h2><p><img src="/2024/05/03/ray-autoscaler/scheduler.webp" alt="scheduler"></p>
<p>当资源请求 (i.e RequestWorkerLease PRC) 被 raylet 接受之后, 整个过程就如上图的状态机一样，<strong>主要包含三个状态:</strong></p>
<ol>
<li><strong>Granted</strong>: 在这个状态下，client 是可以使用申请的资源和 raylet 返回来的对应的 worker 去运行 actor 和 task 的。</li>
<li><strong>Reschedule</strong>: 如果有比本地节点更合适的节点的时候，就需要重新调度到别的节点，这个过程就是重新调度的过程。在这个过程中，本地节点是可以从集群视角去看到集群全部节点的资源使用情况。</li>
<li><strong>Canceled</strong>: 当申请的资源无法被满足的时候，就会取消本地的调度。比如一个 client 请求了一个特定的机器，但是这个机器挂了。再比如，给 task 请求分配的运行环境不能正常的创建出来，就会导致 raylet 不能启动 worker 去运行 task，这个时候调度的请求也会被取消。</li>
</ol>
<p><strong>调度策略主要包含：</strong></p>
<ul>
<li><p><strong>Hybrid Policy</strong>：如果不指定特定的调度策略，这个就是一种默认的调度策略。</p>
<ol>
<li>该策略首先是尝试将 task 放在自己本地来运行，但是当本地节点的资源使用量超过了配置的阈值（默认为 50%），就将 task 分配到其它的机器上，这个分配机器的过程是按照机器的 ID 进行排序（保证每次都按照相同顺序来），这里有第一远程节点、第二远程节点等等，依此类推，直到所有节点上的关键资源利用率都超过阈值。它将选择资源利用率最低的节点。</li>
<li>该策略是在 bin-packing 和 load-balancing 之间进行平衡。<strong>bin-packing 的场景就是先紧着第一台机器，等第一台机器实在不行了，再到第二台，这种会造成大部分有 task 的机器的负载都很高，会导致一些不确定的问题</strong>，机器的负载高了，什么问题都可能发生。</li>
<li>load-balancing 就是下面介绍的 spread 的方式，简单理解就是，有 task 大家一起均摊来运行，这种会有资源碎片化的问题。</li>
</ol>
</li>
<li><p><strong>Spread Policy</strong>：该策略使用轮询的方式，在具有可用资源的节点之间分配 task，这样可以保证所有的 task 在整个集群中比较均衡地分布，不至于某一些机器的负载很高，其它的机器又很空闲。但这种调度的问题是，可能会导致资源碎片化。</p>
</li>
<li><p><strong>Node Affinity Policy</strong>：使用此策略，用户可以明确指定 task 或 actor 应运行的目标节点。如果目标节点处于活动状态，则任务或参与者只会在那里运行。如果目标节点已挂了，则取决于亲和力是否是软限制，task 或 actor 可能会被安排到其他节点或无法被安排。</p>
</li>
<li><p><strong>Data Locality Policy</strong>：简单理解就是，task 可能依赖很多参数对象，task 依赖的参数对象分布在哪个节点多，就调度到哪个节点去，这样就不需要将依赖的参数对象搬来搬去了。就是所谓的，数据本地化策略。</p>
</li>
<li><p><strong>Placement Group Policy</strong>：task 和 actor 将在 placement group 所在的位置运行。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2024/03/03/ray-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/03/ray-basic/" class="post-title-link" itemprop="url">Ray Basic Introdution</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-03 21:49:29" itemprop="dateCreated datePublished" datetime="2024-03-03T21:49:29+08:00">2024-03-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-20 08:44:51" itemprop="dateModified" datetime="2024-08-20T08:44:51+08:00">2024-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ray/" itemprop="url" rel="index"><span itemprop="name">ray</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Ray Basic Introdution" href="/2024/03/03/ray-basic/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::0dcfb037176cdfba7bf4e6d1fb295d0a" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>949</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是-Ray？"><a href="#什么是-Ray？" class="headerlink" title="什么是 Ray？"></a>什么是 Ray？</h2><p>Ray 是一个开源框架，专为构建可扩展的分布式应用程序而设计，旨在通过提供简单直观的 API，简化分布式计算的复杂性，让开发者能够便捷高效地编写并行和分布式 Python 应用程序。</p>
<p>Ray 的统一计算框架由三层组成：</p>
<h3 id="Ray-AI-libraries"><a href="#Ray-AI-libraries" class="headerlink" title="Ray AI libraries"></a>Ray AI libraries</h3><p>一个开源、Python 语言的特定领域库集，为 ML 工程师、数据科学家和研究人员提供了一个可扩展且统一的 ML 应用程序工具包。</p>
<h3 id="Ray-Core"><a href="#Ray-Core" class="headerlink" title="Ray Core"></a>Ray Core</h3><p>一个开源的 Python 通用分布式计算库，使机器学习工程师和 Python 开发人员能够扩展 Python 应用程序并加速机器学习工作负载。</p>
<h3 id="Ray-Cluster"><a href="#Ray-Cluster" class="headerlink" title="Ray Cluster"></a>Ray Cluster</h3><p>Ray 集群由一个 Head 节点（负责协调和管理整个 Ray 集群，以及运行 Ray 的一些关键的全局服务）和若干个 Worker 节点（实际执行计算任务的节点，可以自动伸缩以适应工作负载的资源需求变化）组成，Worker 节点连接到 Head 节点。Ray 集群可以部署在物理机、虚拟机、Kubernetes 以及各种云环境之上。</p>
<p><img src="/2024/03/03/ray-basic/map-of-ray.svg" alt="ray-framework"></p>
<h2 id="Ray-Core-1"><a href="#Ray-Core-1" class="headerlink" title="Ray Core"></a>Ray Core</h2><p>Ray Core 包含以下三个核心概念：</p>
<h3 id="Tasks"><a href="#Tasks" class="headerlink" title="Tasks"></a>Tasks</h3><p>Ray 支持在独立的 Python 工作线程中异步执行任意函数，这些可异步执行的函数称作“任务（Task）”。开发者能够为每个任务配置所需的 CPU、GPU 及其他自定义资源。Ray 集群调度器会根据这些资源请求在集群中合理调度任务，从而实现高效并行处理。</p>
<h3 id="Actors"><a href="#Actors" class="headerlink" title="Actors"></a>Actors</h3><p>参与者（Actor）将 Ray API 从函数（即任务）扩展到类。参与者本质上是一个有状态的工作实体（或服务）。每当一个新的参与者被实例化时，将创建一个新的工作线程，并将该参与者调度到该特定的工作线程上，并且可以访问和改变该工作线程的状态。与任务一样，参与者也支持 CPU、GPU 和自定义资源需求。</p>
<h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><p>在 Ray 中，任务和参与者在对象（Objects）上创建和计算。我们将这些对象称为远程对象（remote objects），因为它们可以存储在 Ray 集群中的任何位置，并且我们使用 objects ref 来引用它们。远程对象缓存在 Ray 的分布式共享内存的对象存储中，并且集群中的每个节点都有一个对象存储。在 Ray 集群设置中，一个远程对象可以驻留在一个或多个节点上，与谁持有 objects ref 无关。</p>
<p><img src="/2024/03/03/ray-basic/ray-core.png" alt="ray core"></p>
<h2 id="Ray-Cluster-1"><a href="#Ray-Cluster-1" class="headerlink" title="Ray Cluster"></a>Ray Cluster</h2><p>Ray Cluster 的基本架构如下图所示。一个 Ray 集群由一个 Head 节点和若干个 Worker 节点组成，Worker 节点通过网络连接到 Head 节点，进行协同和通信。</p>
<p>Head 节点主要负责运行 Ray 集群管理相关的控制进程（以蓝色突出显示），例如 Autoscaler、GCS，以及负责运行 Ray 作业的 Driver processes。除此之外，主节点与其他 Worker 节点无异，Ray 可以像任何其他 Worker 节点一样在 Head 节点上调度任务。</p>
<p><strong>Worker 节点则专注于执行 Ray 作业中用户的应用程序代码</strong>，不运行任何 Head 节点中的控制和管理进程。它们参与分布式调度，以及 Ray Objects 在集群内存中的存储和分发。</p>
<p><img src="/2024/03/03/ray-basic/ray-cluster.svg" alt="ray cluster"></p>
<p>要在生产环境中跨多台机器部署 Ray，首要步骤是部署一个由 Head 节点和 Worker 节点（Ray 节点在 Kubernetes 上运行时实现为 pod）构成的 Ray 集群。该集群支持通过 Ray 自带的 autoscaler 功能实现弹性扩缩。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2024/01/12/lex-yacc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/12/lex-yacc/" class="post-title-link" itemprop="url">Introduction with Lex and Yacc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-12 20:21:49" itemprop="dateCreated datePublished" datetime="2024-01-12T20:21:49+08:00">2024-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-20 08:44:51" itemprop="dateModified" datetime="2024-08-20T08:44:51+08:00">2024-08-20</time>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Introduction with Lex and Yacc" href="/2024/01/12/lex-yacc/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::75be2f878494141dd78d138fe5d2698c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Lex（Flex）和Yacc（Bison）是用于词法分析和语法分析的工具，常用于编写编译器和解释器。</p>
</blockquote>
<h2 id="Lex（Flex）基础"><a href="#Lex（Flex）基础" class="headerlink" title="Lex（Flex）基础"></a>Lex（Flex）基础</h2><h3 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h3><p>词法分析是将输入文本拆分成一个个基本单元的过程，这些基本单元称为词法单元（token）。例如，在 C 语言中，标识符、关键字、数字、运算符等都是词法单元。</p>
<h3 id="Lex-的工作原理"><a href="#Lex-的工作原理" class="headerlink" title="Lex 的工作原理"></a>Lex 的工作原理</h3><p>Lex是一个生成词法分析器的工具。它的输入是一个包含正则表达式和相应动作的文件，输出是一个C语言源文件，该文件包含词法分析器的代码。</p>
<h3 id="Lex文件结构"><a href="#Lex文件结构" class="headerlink" title="Lex文件结构"></a>Lex文件结构</h3><p>一个典型的Lex文件（通常以.l或.lex为扩展名）包含三个部分：</p>
<ul>
<li>定义部分： 使用<code>%&#123;...%&#125;</code>定义变量、常量和宏。</li>
<li>规则部分： 定义词法规则，使用正则表达式描述词法单元的模式。</li>
<li>C 代码部分： 包含辅助函数和程序入口点。</li>
</ul>
<h3 id="简单的词法分析器"><a href="#简单的词法分析器" class="headerlink" title="简单的词法分析器"></a>简单的词法分析器</h3><p>创建一个名为simple.l的文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">[0-9]+          &#123; printf(&quot;Number: %s\n&quot;, yytext); &#125;</span><br><span class="line">[a-zA-Z]+       &#123; printf(&quot;Word: %s\n&quot;, yytext); &#125;</span><br><span class="line">\\n              &#123; /* 忽略换行符 */ &#125;</span><br><span class="line">.               &#123; printf(&quot;Unknown character: %s\n&quot;, yytext); &#125;</span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">int yywarp()</span><br><span class="line">&#123;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    yylex();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编译和运行"><a href="#编译和运行" class="headerlink" title="编译和运行"></a>编译和运行</h3><p>使用Flex编译Lex文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flex simple.l</span><br></pre></td></tr></table></figure>
<p>这将生成一个名为<code>lex.yy.c</code>的C源文件。接下来，编译这个C文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc lex.yy.c -o lexer</span><br></pre></td></tr></table></figure>
<p>假设输入文件<code>input.txt</code>内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello</span><br><span class="line">123</span><br><span class="line">!</span><br></pre></td></tr></table></figure>
<p>运行生成的可执行文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./lexer &lt; input.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2024/01/12/lex-yacc/lexer.png" alt="alt text"></p>
<h2 id="Yacc（Bison）基础"><a href="#Yacc（Bison）基础" class="headerlink" title="Yacc（Bison）基础"></a>Yacc（Bison）基础</h2><h3 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h3><p>语法分析是检查词法单元之间的关系，并构建抽象语法树的过程。例如，在 C 语言中，语法分析器会检查表达式、语句和函数定义的语法是否正确。</p>
<h3 id="Yacc-的工作原理"><a href="#Yacc-的工作原理" class="headerlink" title="Yacc 的工作原理"></a>Yacc 的工作原理</h3><p>Yacc 工具接受一个描述语法规则的输入文件，并生成一个 C 代码文件，该文件包含一个语法分析器函数。这个函数可以被编译并链接到你的程序中，用于解析输入文本的语法。</p>
<h3 id="Yacc-文件结构"><a href="#Yacc-文件结构" class="headerlink" title="Yacc 文件结构"></a>Yacc 文件结构</h3><p>Yacc 文件通常由三部分组成：</p>
<ul>
<li>声明部分： 使用 %{…} 定义数据类型、函数和变量。</li>
<li>规则部分： 定义语法规则，使用 BNF 或类似的语法描述语言描述句法的结构。</li>
<li>C 代码部分： 包含辅助函数和程序入口点。</li>
</ul>
<h3 id="示例：简单的语法分析器"><a href="#示例：简单的语法分析器" class="headerlink" title="示例：简单的语法分析器"></a>示例：简单的语法分析器</h3><p>创建一个名为<code>parser.y</code>的文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%token NUMBER</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">expression : NUMBER &#123; printf(&quot;Expression value: %d\n&quot;, $1); &#125;</span><br><span class="line">            | expression &#x27;+&#x27; expression &#123; printf(&quot;Addition\n&quot;); &#125;</span><br><span class="line">            | expression &#x27;-&#x27; expression &#123; printf(&quot;Subtraction\n&quot;); &#125;</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">int yyerror(char *s) &#123;</span><br><span class="line">    fprintf(stderr, &quot;Error: %s\n&quot;, s);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    yyparse();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 Yacc 文件定义了一个语法规则：</p>
<ul>
<li>expression 可以是一个 NUMBER，也可以是两个 expression 之间的加减运算。</li>
</ul>
<h3 id="编译和运行-1"><a href="#编译和运行-1" class="headerlink" title="编译和运行"></a>编译和运行</h3><p>使用Bison编译Yacc文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bison parser.y</span><br><span class="line">gcc parser.tab.c -o parser</span><br></pre></td></tr></table></figure>

<h2 id="使用-Lex-和-Yacc-构建计算器"><a href="#使用-Lex-和-Yacc-构建计算器" class="headerlink" title="使用 Lex 和 Yacc 构建计算器"></a>使用 Lex 和 Yacc 构建计算器</h2><h3 id="词法分析-1"><a href="#词法分析-1" class="headerlink" title="词法分析"></a>词法分析</h3><p>定义<code>lexer.l</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">#include &quot;parser.tab.h&quot;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">[0-9]+   &#123; yylval = atoi(yytext); return NUMBER; &#125;</span><br><span class="line">&quot;+&quot;     &#123; return PLUS; &#125;</span><br><span class="line">&quot;-&quot;     &#123; return MINUS; &#125;</span><br><span class="line">&quot;*&quot;     &#123; return MUL; &#125;</span><br><span class="line">&quot;/&quot;     &#123; return DIV; &#125;</span><br><span class="line">&quot;%&quot;     &#123; return MOD; &#125;</span><br><span class="line">\n      &#123; return EOL; &#125;</span><br><span class="line">.       &#123; printf(&quot;Invalid character: %s\n&quot;, yytext); &#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">int yywrap() </span><br><span class="line">&#123;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="语法分析-1"><a href="#语法分析-1" class="headerlink" title="语法分析"></a>语法分析</h3><p>定义<code>parser.y</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">static double result = 0.0;</span><br><span class="line"></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%token NUMBER PLUS MINUS MUL DIV MOD EOL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">expression : expression PLUS expression  &#123; result = $1 + $3; $$ = result; &#125;</span><br><span class="line">            | expression MINUS expression &#123; result = $1 - $3; $$ = result; &#125;</span><br><span class="line">            | expression MUL expression   &#123; result = $1 * $3; $$ = result; &#125;</span><br><span class="line">            | expression DIV expression   &#123; result = $1 / $3; $$ = result; &#125;</span><br><span class="line">            | expression MOD expression   &#123; result = $1 % $3; $$ = result; &#125;</span><br><span class="line">            | NUMBER                      &#123; result = $1; $$ = result; &#125;</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">int yyerror(char *s) &#123;</span><br><span class="line">    fprintf(stderr, &quot;Error: %s\n&quot;, s);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    printf(&quot;Enter an expression: &quot;);</span><br><span class="line">    yyparse();</span><br><span class="line">    printf(&quot;Result: %lf\n&quot;, result);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 Yacc 文件定义了计算器支持的表达式语法，并使用 <code>$$</code>变量存储计算结果。</p>
<h3 id="编译和运行计算器"><a href="#编译和运行计算器" class="headerlink" title="编译和运行计算器"></a>编译和运行计算器</h3><p>使用以下命令编译和运行计算器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flex lexer.l</span><br><span class="line">bison parser.y</span><br><span class="line">gcc lexer.yy.c parser.tab.c -o calculator</span><br></pre></td></tr></table></figure>

<p><code>./calculator</code><br>输入一个表达式，例如 1 + 2 * 3，计算器会计算结果并打印出来。</p>
<p><img src="/2024/01/12/lex-yacc/calc.png" alt="alt text"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Lex 和 Yacc 是构建编译器和解释器等复杂程序的强大工具。通过使用 Lex 进行词法分析，使用 Yacc 进行语法分析，可以有效地构建满足特定需求的文本分析器。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2023/11/03/range-utilities/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/03/range-utilities/" class="post-title-link" itemprop="url">STL - Range Utilities</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-03 09:13:14" itemprop="dateCreated datePublished" datetime="2023-11-03T09:13:14+08:00">2023-11-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-23 10:58:41" itemprop="dateModified" datetime="2024-08-23T10:58:41+08:00">2024-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Standard-Library-Algorithms/" itemprop="url" rel="index"><span itemprop="name">Standard Library Algorithms</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="STL - Range Utilities" href="/2023/11/03/range-utilities/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::94bca7155834cea89fce2c5bb366c6d8" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>424</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>A Simple Introduction to C++ Standard Library Algorithms: Range Utilities.</p>
</blockquote>
<h2 id="Utilities"><a href="#Utilities" class="headerlink" title="Utilities"></a>Utilities</h2><h3 id="distance"><a href="#distance" class="headerlink" title="distance"></a>distance</h3><blockquote>
<p>Avoid using distance with iterators into non-random access containers like std::list, because the runtime will be proportional to the size of the input range!</p>
</blockquote>
<ul>
<li><p>into<br><img src="/2023/11/03/range-utilities/distance.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// size of subrange (as shown in image)</span></span><br><span class="line"><span class="keyword">auto</span> n = <span class="built_in">distance</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>);  <span class="comment">// 5</span></span><br><span class="line"><span class="comment">// size of entire container</span></span><br><span class="line"><span class="keyword">auto</span> m = <span class="built_in">distance</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v));        <span class="comment">// 9</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; w &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// get index of smallest element in w:</span></span><br><span class="line"><span class="keyword">auto</span> argmin = <span class="built_in">distance</span>(<span class="built_in">begin</span>(w), <span class="built_in">min_element</span>(<span class="built_in">begin</span>(w),<span class="built_in">end</span>(w)) );  <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="for-each-x2F-for-each-n-c-17"><a href="#for-each-x2F-for-each-n-c-17" class="headerlink" title="for_each &#x2F; for_each_n(c++17)"></a>for_each &#x2F; for_each_n(c++17)</h3><ul>
<li><p>into<br><img src="/2023/11/03/range-utilities/for_each.png" alt="alt text"></p>
</li>
<li><p>for_each</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Container&lt;Type&gt; v; …</span><br><span class="line"></span><br><span class="line"><span class="comment">// read-only, type cheap to copy or copy needed:</span></span><br><span class="line">for_each(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v),       [](Type x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line">for_each(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">5</span>, [](<span class="keyword">auto</span> x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// read-only, type expensive to copy:</span></span><br><span class="line">for_each(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), [](Type <span class="type">const</span>&amp; x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line">for_each(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), [](<span class="keyword">auto</span> <span class="type">const</span>&amp; x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// modify values:</span></span><br><span class="line">for_each(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), [](Type&amp; x)&#123; cin &gt;&gt; x; &#125;);</span><br><span class="line">for_each(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), [](<span class="keyword">auto</span>&amp; x)&#123; cin &gt;&gt; x; &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>for_each_n(c++17)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Container&lt;Type&gt; v; …</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> n = v.<span class="built_in">size</span>() / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// read-only, type cheap to copy or copy needed:</span></span><br><span class="line">for_each_n(<span class="built_in">begin</span>(v), n, [](Type x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// read-only, type expensive to copy:</span></span><br><span class="line">for_each_n(<span class="built_in">begin</span>(v), n, [](Type <span class="type">const</span>&amp; x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// modify values:</span></span><br><span class="line">for_each_n(<span class="built_in">begin</span>(v), n, [](Type&amp; x)&#123; cin &gt;&gt; x; &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Container&lt;Type&gt; v; …</span><br><span class="line"></span><br><span class="line"><span class="comment">// read-only, type cheap to copy or copy needed:</span></span><br><span class="line">ranges::for_each(v, [](Type x)&#123; cout &lt;&lt; x; &#125;); </span><br><span class="line">ranges::for_each(v, [](<span class="keyword">auto</span> x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// read-only, type expensive to copy:</span></span><br><span class="line">ranges::for_each(v, [](Type <span class="type">const</span>&amp; x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line">ranges::for_each(v, [](<span class="keyword">auto</span> <span class="type">const</span>&amp; x)&#123; cout &lt;&lt; x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// modify values:</span></span><br><span class="line">ranges::for_each(v, [](Type&amp; x)&#123; cin &gt;&gt; x; &#125;);</span><br><span class="line">ranges::for_each(v, [](<span class="keyword">auto</span>&amp; x)&#123; cin &gt;&gt; x; &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="next-x2F-prev"><a href="#next-x2F-prev" class="headerlink" title="next&#x2F;prev"></a>next&#x2F;prev</h3><blockquote>
<p>Functions std::prev and std::next provide a universal way of incrementing&#x2F;decrementing iterators even if the iterator type does not support random access (e.g., it +&#x3D; 5).<br>However, be aware that advancing non-random access iterators (e.g., those from std::list) by N steps might be costly, i.e., involve on the order of N memory operations.</p>
</blockquote>
<ul>
<li><p>into<br><img src="/2023/11/03/range-utilities/next_prev.png" alt="alt text"></p>
</li>
<li><p>next</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> i = <span class="built_in">next</span>(v.<span class="built_in">begin</span>());</span><br><span class="line"><span class="keyword">auto</span> j = <span class="built_in">next</span>(i, <span class="number">3</span>); <span class="comment">// c++11</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>prev</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> i = <span class="built_in">prev</span>(v.<span class="built_in">end</span>()); <span class="comment">// 6</span></span><br><span class="line">     i = <span class="built_in">prev</span>(i); <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> j = <span class="built_in">prev</span>(i, <span class="number">3</span>); <span class="comment">// 2 (c++11)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="iter-swap"><a href="#iter-swap" class="headerlink" title="iter_swap"></a>iter_swap</h3><ul>
<li><p>intro<br><img src="/2023/11/03/range-utilities/iter_swap.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; w &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">iter_swap</span>(<span class="built_in">begin</span>(v)+<span class="number">1</span>, <span class="built_in">begin</span>(w)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 3 8</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : w) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 2 1 4 5</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/std/algorithms.html">Hacking cpp Standard Library Algorithms</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2023/11/02/range-copy-move/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/02/range-copy-move/" class="post-title-link" itemprop="url">STL - Range Copy/Move Algorithms</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-02 09:13:14" itemprop="dateCreated datePublished" datetime="2023-11-02T09:13:14+08:00">2023-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-23 10:08:38" itemprop="dateModified" datetime="2024-08-23T10:08:38+08:00">2024-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Standard-Library-Algorithms/" itemprop="url" rel="index"><span itemprop="name">Standard Library Algorithms</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="STL - Range Copy/Move Algorithms" href="/2023/11/02/range-copy-move/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::bf4175ae2a5388a3aadacd76a528f4fe" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>851</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>A Simple Introduction to C++ Standard Library Algorithms: Range Copy &amp;&amp; Move.</p>
</blockquote>
<h2 id="Copy-Algorithms"><a href="#Copy-Algorithms" class="headerlink" title="Copy Algorithms"></a>Copy Algorithms</h2><p>Target ranges must be able to receive all copied elements!</p>
<p>This means that, e.g., target containers must be <strong>resized properly</strong>. Standard algorithms don’t – and in most cases can’t – check if the target range is large enough.</p>
<p>Trying to copy elements beyond the target’s capacity will invoke <strong>undefined behavior</strong>!</p>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><ul>
<li><p>into<br><img src="/2023/11/02/range-copy-move/copy.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="type">const</span> n = <span class="number">5</span>;</span><br><span class="line">tgt.<span class="built_in">resize</span>(n);</span><br><span class="line"></span><br><span class="line"><span class="built_in">copy</span>(<span class="built_in">begin</span>(src)+<span class="number">3</span>, <span class="built_in">begin</span>(src)+<span class="number">8</span>, <span class="built_in">begin</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 5 6 7 8</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; bad;</span><br><span class="line">bad.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//  UNDEFINED BEHAVIOR: target size is too small!</span></span><br><span class="line"><span class="built_in">copy</span>(<span class="built_in">begin</span>(src), <span class="built_in">end</span>(src), <span class="built_in">begin</span>(bad));</span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(src.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">std::ranges::<span class="built_in">copy</span>(src, <span class="built_in">begin</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 5 6 7 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="copy-n-c-11"><a href="#copy-n-c-11" class="headerlink" title="copy_n(c++11)"></a>copy_n(c++11)</h3><ul>
<li><p>into<br><img src="/2023/11/02/range-copy-move/copy_n.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line"><span class="type">int</span> <span class="type">const</span> n = <span class="number">5</span>;</span><br><span class="line">tgt.<span class="built_in">resize</span>(n);</span><br><span class="line"></span><br><span class="line"><span class="built_in">copy_n</span>(<span class="built_in">begin</span>(src)+<span class="number">3</span>, n, <span class="built_in">begin</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 5 6 7 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="copy-backward-c-11"><a href="#copy-backward-c-11" class="headerlink" title="copy_backward(c++11)"></a>copy_backward(c++11)</h3><ul>
<li><p>into<br><img src="/2023/11/02/range-copy-move/copy_backward.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">copy_backward</span>(<span class="built_in">begin</span>(src)+<span class="number">3</span>, <span class="built_in">begin</span>(src)+<span class="number">8</span>, <span class="built_in">end</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 5 6 7 8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(src.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">std::ranges::<span class="built_in">copy_backward</span>(src, <span class="built_in">end</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 5 6 7 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="copy-if"><a href="#copy-if" class="headerlink" title="copy_if"></a>copy_if</h3><ul>
<li><p>into<br><img src="/2023/11/02/range-copy-move/copy_if.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> e = <span class="built_in">copy_if</span> (<span class="built_in">begin</span>(src)+<span class="number">2</span>, <span class="built_in">begin</span>(src)+<span class="number">7</span>, <span class="built_in">begin</span>(tgt), is_even);</span><br><span class="line"><span class="comment">// how many elements copied?</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> copy_count = <span class="built_in">distance</span>(<span class="built_in">begin</span>(tgt), e);  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// resize to fit</span></span><br><span class="line">tgt.<span class="built_in">erase</span>(e, <span class="built_in">end</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 6 8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; src &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> e = std::ranges::<span class="built_in">copy_if</span> (src, <span class="built_in">begin</span>(tgt), is_even);</span><br><span class="line"><span class="comment">// how many elements copied?</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> copy_count = <span class="built_in">distance</span>(<span class="built_in">begin</span>(tgt), e.out);  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// resize to fit</span></span><br><span class="line">tgt.<span class="built_in">erase</span>(e.out, <span class="built_in">end</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 6 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="sample-c-17"><a href="#sample-c-17" class="headerlink" title="sample(c++17)"></a>sample(c++17)</h3><ul>
<li><p>into<br>Samples n elements in the given sequence (without replacement) where every element has an equal chance of being selected.<br><img src="/2023/11/02/range-copy-move/sample.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="comment">// 32 bit mersenne twister engine</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> seed = std::random_device&#123;&#125;();</span><br><span class="line"><span class="keyword">auto</span> reng = std::mt19937&#123;seed&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="type">const</span> n = <span class="number">4</span>;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; samples;</span><br><span class="line">samples.<span class="built_in">resize</span>(n);</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; pop &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sample</span>(<span class="built_in">begin</span>(pop), <span class="built_in">end</span>(pop), <span class="built_in">begin</span>(samples), n, reng);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : samples) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 4 6 8(one case, may be other elems)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="comment">// 32 bit mersenne twister engine</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> seed = std::random_device&#123;&#125;();</span><br><span class="line"><span class="keyword">auto</span> reng = std::mt19937&#123;seed&#125;;</span><br><span class="line"><span class="type">int</span> <span class="type">const</span> n = <span class="number">4</span>;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; samples;</span><br><span class="line">samples.<span class="built_in">resize</span>(n);</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; pop &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line">std::ranges::<span class="built_in">sample</span>(pop, <span class="built_in">begin</span>(samples), n, reng);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : samples) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 4 6 8（one case, may be other elems）</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Move-Algorithms"><a href="#Move-Algorithms" class="headerlink" title="Move Algorithms"></a>Move Algorithms</h2><h3 id="move-C-11"><a href="#move-C-11" class="headerlink" title="move(C++11)"></a>move(C++11)</h3><ul>
<li><p>into<br><img src="/2023/11/02/range-copy-move/move.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="type">lines_t</span> = std::vector&lt;std::string&gt;;</span><br><span class="line"><span class="type">lines_t</span> src &#123;<span class="string">&quot;X&quot;</span>,<span class="string">&quot;Y&quot;</span>,<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>,<span class="string">&quot;E&quot;</span>,<span class="string">&quot;F&quot;</span>,<span class="string">&quot;G&quot;</span>&#125;;</span><br><span class="line"><span class="type">lines_t</span> tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">5</span>);</span><br><span class="line"><span class="built_in">move</span>(<span class="built_in">begin</span>(src)+<span class="number">2</span>, <span class="built_in">begin</span>(src)+<span class="number">7</span>, <span class="built_in">begin</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> <span class="type">const</span>&amp; x : tgt) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// A B C D E</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> X = std::vector&lt;std::vector&lt;<span class="type">int</span>&gt;&gt;;</span><br><span class="line">X v &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;, &#123;<span class="number">4</span>,<span class="number">5</span>&#125;, &#123;<span class="number">7</span>,<span class="number">8</span>&#125;&#125;;</span><br><span class="line">X w; w.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">move</span>(<span class="built_in">begin</span>(v)+<span class="number">1</span>, <span class="built_in">end</span>(v), <span class="built_in">begin</span>(w)); <span class="comment">// v: &#123;&#123;1,2,3&#125;,&#123;&#125;,&#123;&#125;&#125;, w: &#123;&#123;4,5&#125;,&#123;7,8&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">v.<span class="built_in">erase</span>(<span class="built_in">begin</span>(v)+<span class="number">1</span>, <span class="built_in">end</span>(v)); <span class="comment">// v: &#123;&#123;1,2,3&#125;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="type">lines_t</span> = std::vector&lt;std::string&gt;;</span><br><span class="line"><span class="type">lines_t</span> src &#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>,<span class="string">&quot;E&quot;</span>&#125;;</span><br><span class="line"><span class="type">lines_t</span> tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ends = std::ranges::<span class="built_in">move</span>(src, <span class="built_in">begin</span>(tgt)+<span class="number">1</span>);</span><br><span class="line">for_each(<span class="built_in">begin</span>(tgt)+<span class="number">1</span>, ends.out, [](<span class="keyword">auto</span> <span class="type">const</span>&amp; x) &#123; </span><br><span class="line">  std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;); <span class="comment">// A B C D E</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="move-backward-C-11"><a href="#move-backward-C-11" class="headerlink" title="move_backward(C++11)"></a>move_backward(C++11)</h3><ul>
<li><p>into<br><img src="/2023/11/02/range-copy-move/move_backward.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="type">lines_t</span> = std::vector&lt;std::string&gt;;</span><br><span class="line"><span class="type">lines_t</span> src &#123;<span class="string">&quot;X&quot;</span>,<span class="string">&quot;Y&quot;</span>,<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>,<span class="string">&quot;E&quot;</span>,<span class="string">&quot;F&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">lines_t</span> tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">move_backward</span>(<span class="built_in">begin</span>(src)+<span class="number">2</span>, <span class="built_in">begin</span>(src)+<span class="number">7</span>, <span class="built_in">end</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> <span class="type">const</span>&amp; x : tgt) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// A B C D E</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="type">lines_t</span> = std::vector&lt;std::string&gt;;</span><br><span class="line"><span class="type">lines_t</span> src &#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>,<span class="string">&quot;E&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">lines_t</span> tgt;</span><br><span class="line">tgt.<span class="built_in">resize</span>(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ends = std::ranges::<span class="built_in">move_backward</span>(src, <span class="built_in">end</span>(tgt));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> <span class="type">const</span>&amp; x : tgt) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// A B C D E</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="swap-ranges"><a href="#swap-ranges" class="headerlink" title="swap_ranges"></a>swap_ranges</h3><ul>
<li><p>intro<br><img src="/2023/11/02/range-copy-move/swap_ranges.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; r1 &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; r2 &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// swap subranges (as shown in image):</span></span><br><span class="line"><span class="built_in">swap_ranges</span>(<span class="built_in">begin</span>(r1)+<span class="number">1</span>, <span class="built_in">begin</span>(r1)+<span class="number">5</span>, <span class="built_in">begin</span>(r2)+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : r1) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 8 7 6 5 5</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : r2) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 9 1 2 3 4 3 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; range1 &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; range2 &#123;<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">9</span>&#125;;</span><br><span class="line"></span><br><span class="line">std::ranges::<span class="built_in">swap_ranges</span>(range1, range2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : range1) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 8 7 6 5</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : range2) &#123; cout &lt;&lt; x &lt;&lt;<span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 3 4 9 9</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/std/algorithms.html">Hacking cpp Standard Library Algorithms</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2023/11/01/numeric-operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/01/numeric-operations/" class="post-title-link" itemprop="url">STL - Numeric Operations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-01 09:13:14" itemprop="dateCreated datePublished" datetime="2023-11-01T09:13:14+08:00">2023-11-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-23 08:56:56" itemprop="dateModified" datetime="2024-08-23T08:56:56+08:00">2024-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Standard-Library-Algorithms/" itemprop="url" rel="index"><span itemprop="name">Standard Library Algorithms</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="STL - Numeric Operations" href="/2023/11/01/numeric-operations/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d877612c9b4d2f1815721ca07a6e266e" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Reductions"><a href="#Reductions" class="headerlink" title="Reductions"></a>Reductions</h2><blockquote>
<p>produce one result based on a sequence of input elements</p>
</blockquote>
<h3 id="reduce-c-17"><a href="#reduce-c-17" class="headerlink" title="reduce(c++17)"></a>reduce(c++17)</h3><ul>
<li><p>intro<br><img src="/2023/11/01/numeric-operations/reduce.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> sum = <span class="built_in">reduce</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v));  <span class="comment">// 1+9+7+3+2+8 = 30</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> s47 = <span class="built_in">reduce</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">47</span>);  <span class="comment">// 47+1+9+7+3+2+8 = 77</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; w &#123;<span class="number">2.0</span>, <span class="number">1.5</span>, <span class="number">3.0</span>, <span class="number">1.5</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> product = <span class="built_in">reduce</span>(<span class="built_in">begin</span>(w), <span class="built_in">end</span>(w), <span class="number">1.0</span>, std::multiplies&lt;&gt;&#123;&#125;);  </span><br><span class="line"><span class="comment">// double product = 1.0 * 2.0 * 1.5 * 3.0 * 1.5 = 13.5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> psum = <span class="built_in">reduce</span>(std::execution::par, <span class="built_in">begin</span>(v), <span class="built_in">end</span>(v));</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="transform-reduce-c-17"><a href="#transform-reduce-c-17" class="headerlink" title="transform_reduce(c++17)"></a>transform_reduce(c++17)</h3><ul>
<li><p>intro<br><img src="/2023/11/01/numeric-operations/transform_reduce.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> f = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x*x; &#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> rf = <span class="built_in">transform_reduce</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">1</span>, std::plus&lt;&gt;&#123;&#125;, f);  </span><br><span class="line"><span class="comment">// rf = 1 + f(3) + f(2) + f(4) = 30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; x &#123;<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">5.0</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; y &#123;<span class="number">2.0</span>, <span class="number">4.0</span>, <span class="number">8.0</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> rx1 = <span class="built_in">transform_reduce</span>(<span class="built_in">begin</span>(x), <span class="built_in">end</span>(x), <span class="built_in">begin</span>(y), <span class="number">10.0</span>);  </span><br><span class="line"><span class="comment">// rx1 = 10 + (1⋅2)+(3⋅4)+(5⋅8) = 64</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> rx2 = <span class="built_in">transform_reduce</span>(</span><br><span class="line">    <span class="built_in">begin</span>(x), <span class="built_in">end</span>(x), <span class="built_in">begin</span>(y), <span class="number">0.0</span>, </span><br><span class="line">    std::plus&lt;&gt;&#123;&#125;, std::divides&lt;&gt;&#123;&#125;);  </span><br><span class="line"><span class="comment">// rx2 = 0.0 + (1/2)+(3/4)+(5/8) = 1.875</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="accumulate-≈-reduce"><a href="#accumulate-≈-reduce" class="headerlink" title="accumulate(≈ reduce)"></a>accumulate(≈ reduce)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/accumulate.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> sum = <span class="built_in">accumulate</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">0</span>);  <span class="comment">// 1+9+7+3+2+8 = 30</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> s47 = <span class="built_in">accumulate</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">47</span>);  <span class="comment">// 47+1+9+7+3+2+8 = 77</span></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; w &#123;<span class="number">2.0</span>, <span class="number">1.5</span>, <span class="number">3.0</span>, <span class="number">1.5</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> product = <span class="built_in">accumulate</span>(<span class="built_in">begin</span>(w), <span class="built_in">end</span>(w), <span class="number">1.0</span>, std::multiplies&lt;&gt;&#123;&#125;);</span><br><span class="line"><span class="comment">// double product = 1.0 * 2.0 * 1.5 * 3.0 * 1.5 = 13.5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>narrower</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// narrower initial value type might lead to loss of information:</span></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; v &#123;<span class="number">1.2</span>, <span class="number">2.4</span>&#125;;                     </span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> wtf = <span class="built_in">accumulate</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">0</span>);  </span><br><span class="line">cout &lt;&lt; wtf;  <span class="comment">// 3                  int ^</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> sum = <span class="built_in">accumulate</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">0.0</span>);  </span><br><span class="line">cout &lt;&lt; sum;  <span class="comment">// 3.6             double ^^^</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="inner-product-≈-transform-reduce"><a href="#inner-product-≈-transform-reduce" class="headerlink" title="inner_product(≈ transform_reduce)"></a>inner_product(≈ transform_reduce)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/inner_product.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; w &#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> ip = <span class="built_in">inner_product</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="built_in">begin</span>(w), <span class="number">50</span>);  </span><br><span class="line"><span class="comment">// ip = 50 + (4⋅10)+(3⋅20)+(2⋅30)+(1⋅40) = 250</span></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; num &#123;<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">5.0</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; den &#123;<span class="number">2.0</span>, <span class="number">4.0</span>, <span class="number">8.0</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> res = <span class="built_in">inner_product</span>(</span><br><span class="line">    <span class="built_in">begin</span>(num), <span class="built_in">end</span>(num), <span class="built_in">begin</span>(den), <span class="number">0.0</span>, </span><br><span class="line">    std::plus&lt;&gt;&#123;&#125;, std::divides&lt;&gt;&#123;&#125; );  </span><br><span class="line"><span class="comment">// res = 0.0 + (1/2)+(3/4)+(5/8) = 1.875</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Scans"><a href="#Scans" class="headerlink" title="Scans"></a>Scans</h2><blockquote>
<p>produce a sequence of results with the same number of elements as the input sequence</p>
</blockquote>
<h3 id="adjacent-difference"><a href="#adjacent-difference" class="headerlink" title="adjacent_difference"></a>adjacent_difference</h3><ul>
<li><p>intro<br><img src="/2023/11/01/numeric-operations/adjacent_difference.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit results</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">adjacent_difference</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 1 4 2 -5 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17: can supply custom operation</span></span><br><span class="line"><span class="built_in">adjacent_difference</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::plus&lt;&gt;&#123;&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 8 14 11 9</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">adjacent_difference</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::multiplies&lt;&gt;&#123;&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 12 48 24 18</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="inclusive-scan-c-17"><a href="#inclusive-scan-c-17" class="headerlink" title="inclusive_scan(c++17)"></a>inclusive_scan(c++17)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/inclusive_scan.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit results</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">inclusive_scan</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 2 3 10 15 18</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">inclusive_scan</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::minus&lt;&gt;&#123;&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 2 1 -6 -11 -14</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with offset &#x27;3&#x27;:</span></span><br><span class="line"><span class="built_in">inclusive_scan</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::plus&lt;&gt;&#123;&#125;, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 5 6 13 18 21</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="exclusive-scan-c-17"><a href="#exclusive-scan-c-17" class="headerlink" title="exclusive_scan(c++17)"></a>exclusive_scan(c++17)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/exclusive_scan.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit results</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">exclusive_scan</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 2 3 10 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with offset &#x27;3&#x27;:</span></span><br><span class="line"><span class="built_in">exclusive_scan</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), <span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 3 5 6 13 18</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exclusive_scan</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), <span class="number">0</span>, std::minus&lt;&gt;&#123;&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 -2 -3 -10 -15</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="transform-inclusive-scan-c-17"><a href="#transform-inclusive-scan-c-17" class="headerlink" title="transform_inclusive_scan(c++17)"></a>transform_inclusive_scan(c++17)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/transform_inclusive_scan.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returns value only if even and 0 if odd</span></span><br><span class="line"><span class="keyword">auto</span> even_only = [](<span class="type">int</span> x) &#123; <span class="built_in">return</span> (x &amp; <span class="number">1</span>) ? <span class="number">0</span> : x; &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit results</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">transform_inclusive_scan</span>(</span><br><span class="line">  <span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::plus&lt;&gt;&#123;&#125;, even_only);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 2 2 8 12 12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with offset &#x27;3&#x27;:</span></span><br><span class="line"><span class="built_in">transform_inclusive_scan</span>(</span><br><span class="line">  <span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::plus&lt;&gt;&#123;&#125;, even_only, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 5 5 11 15 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with projection f(x) = -x2:</span></span><br><span class="line"><span class="built_in">transform_inclusive_scan</span>(</span><br><span class="line">  <span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::plus&lt;&gt;&#123;&#125;, </span><br><span class="line">  [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> -(x*x); &#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// -4 -5 -41 -57 -66</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="transform-exclusive-scan-c-17"><a href="#transform-exclusive-scan-c-17" class="headerlink" title="transform_exclusive_scan(c++17)"></a>transform_exclusive_scan(c++17)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/transform_exclusive_scan.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returns value only if even and 0 if odd</span></span><br><span class="line"><span class="keyword">auto</span> even_only = [](<span class="type">int</span> x) &#123; <span class="built_in">return</span> (x &amp; <span class="number">1</span>) ? <span class="number">0</span> : x; &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit results</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">transform_exclusive_scan</span>(</span><br><span class="line">  <span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), <span class="number">0</span>, std::plus&lt;&gt;&#123;&#125;, even_only);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 2 2 8 12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with offset &#x27;3&#x27;:</span></span><br><span class="line"><span class="built_in">transform_exclusive_scan</span>(</span><br><span class="line">  <span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), <span class="number">3</span>, std::plus&lt;&gt;&#123;&#125;, even_only);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 3 5 5 11 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with projection f(x) = -x2:</span></span><br><span class="line"><span class="built_in">transform_exclusive_scan</span>(</span><br><span class="line">  <span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), <span class="number">0</span>, std::plus&lt;&gt;&#123;&#125;, </span><br><span class="line">  [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> -(x*x); &#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 -4 -5 -41 -57</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="partial-sum-≈-inclusive-scan"><a href="#partial-sum-≈-inclusive-scan" class="headerlink" title="partial_sum (≈ inclusive_scan)"></a>partial_sum (≈ inclusive_scan)</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/partial_sum.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit results</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"><span class="built_in">partial_sum</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 4 6 7 8</span></span><br><span class="line"><span class="built_in">partial_sum</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out), std::minus&lt;&gt;&#123;&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 0 -2 -4 -5 -6</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><h3 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h3><ul>
<li><p>into<br><img src="/2023/11/01/numeric-operations/iota.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">v.<span class="built_in">resize</span>(<span class="number">9</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">// fill subrange (as shown in image)</span></span><br><span class="line"><span class="built_in">iota</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 0 1 2 3 4 5 0 0</span></span><br><span class="line"><span class="comment">// fill entire vector</span></span><br><span class="line"><span class="built_in">iota</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 3 4 5 6 7 8 9 10 11</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">v.<span class="built_in">resize</span>(<span class="number">5</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> might not be available yet</span></span><br><span class="line"><span class="comment">// in many standard library implementations!</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> result = ranges::<span class="built_in">iota</span>(v, <span class="number">3</span>);</span><br><span class="line">std::cout &lt;&lt; result.value;  <span class="comment">// 8</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 3 4 5 6 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/std/algorithms.html">Hacking cpp Standard Library Algorithms</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2023/10/04/modifying-elements/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/10/04/modifying-elements/" class="post-title-link" itemprop="url">STL - Modifying Operations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-04 09:13:14" itemprop="dateCreated datePublished" datetime="2023-10-04T09:13:14+08:00">2023-10-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-22 10:41:19" itemprop="dateModified" datetime="2024-08-22T10:41:19+08:00">2024-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Standard-Library-Algorithms/" itemprop="url" rel="index"><span itemprop="name">Standard Library Algorithms</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="STL - Modifying Operations" href="/2023/10/04/modifying-elements/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::10856fcfe1f3f19ad856213d0ccaf864" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>A Simple Introduction to C++ Standard Library Algorithms: Modifying Operations Topics.</p>
</blockquote>
<h2 id="Changing-Values"><a href="#Changing-Values" class="headerlink" title="Changing Values"></a>Changing Values</h2><h3 id="fill-x2F-fill-n"><a href="#fill-x2F-fill-n" class="headerlink" title="fill &#x2F; fill_n"></a>fill &#x2F; fill_n</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/fill.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">fill</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 0 2 2 2 2 2 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">fill_n</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 0 2 2 2 2 2 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">9</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">std::ranges::<span class="built_in">fill</span>(v, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 2 2 2 2 2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="generate-x2F-generate-n"><a href="#generate-x2F-generate-n" class="headerlink" title="generate &#x2F; generate_n"></a>generate &#x2F; generate_n</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/generate.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> gen = [i=<span class="number">0</span>]() <span class="keyword">mutable</span> &#123; i += <span class="number">2</span>; <span class="keyword">return</span> i; &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">v.<span class="built_in">resize</span>(<span class="number">7</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">generate</span>(<span class="built_in">begin</span>(v)+<span class="number">1</span>, <span class="built_in">begin</span>(v)+<span class="number">5</span>, gen);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 2 4 6 8 0 0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">generate_n</span>(<span class="built_in">begin</span>(v)+<span class="number">1</span>, <span class="number">4</span>, gen);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 2 4 6 8 0 0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> gen = [i=<span class="number">0</span>]() <span class="keyword">mutable</span> &#123; i += <span class="number">2</span>; <span class="keyword">return</span> i; &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">v.<span class="built_in">resize</span>(<span class="number">4</span>,<span class="number">0</span>);</span><br><span class="line">std::ranges::<span class="built_in">generate</span>(v, gen);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 2 4 6 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h3><ul>
<li><p>into<br>This algorithm is also known as <code>map</code> in other programming languages.<br><img src="/2023/10/04/modifying-elements/transform.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// f: &#x27;x&#x27; → &quot;&lt;x&gt;&quot;</span></span><br><span class="line"><span class="keyword">auto</span> f = [](<span class="type">char</span> c) &#123; <span class="keyword">return</span> std::<span class="built_in">string</span>(<span class="string">&quot;&lt;&quot;</span>) + c + <span class="string">&quot;&gt;&quot;</span>; &#125;;</span><br><span class="line">std::string in = <span class="string">&quot;vwxyza&quot;</span>;</span><br><span class="line">std::vector&lt;std::string&gt; out;</span><br><span class="line"><span class="comment">// make sure &#x27;out&#x27; can fit result</span></span><br><span class="line">out.<span class="built_in">resize</span>(<span class="number">4</span>);</span><br><span class="line"><span class="built_in">transform</span>(<span class="built_in">begin</span>(in)+<span class="number">1</span>, <span class="built_in">begin</span>(in)+<span class="number">5</span>, <span class="built_in">begin</span>(out), f);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> <span class="type">const</span>&amp; x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// &lt;w&gt; &lt;x&gt; &lt;y&gt; &lt;z&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// f: &#x27;y&#x27;,3 → &quot;yyy&quot;</span></span><br><span class="line"><span class="keyword">auto</span> f = [](<span class="type">char</span> c, <span class="type">int</span> i) &#123; <span class="keyword">return</span> std::<span class="built_in">string</span>(i,c); &#125;;</span><br><span class="line">std::string in1 = <span class="string">&quot;wxy&quot;</span>;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in2 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">std::vector&lt;std::string&gt; out;</span><br><span class="line"><span class="comment">// make sure &#x27;out&#x27; can fit result</span></span><br><span class="line">out.<span class="built_in">resize</span>(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">transform</span>(<span class="built_in">begin</span>(in1), <span class="built_in">end</span>(in1), <span class="built_in">begin</span>(in2), <span class="built_in">begin</span>(out), f);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> <span class="type">const</span>&amp; x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// w xx yyy</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Replacing-Values"><a href="#Replacing-Values" class="headerlink" title="Replacing Values"></a>Replacing Values</h2><h3 id="replace-x2F-replace-if"><a href="#replace-x2F-replace-if" class="headerlink" title="replace &#x2F; replace_if"></a>replace &#x2F; replace_if</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/replace.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="built_in">replace</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 3 0 4 0 0 6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">replace_if</span> (<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, is_even, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 3 0 5 0 0 6 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="replace-copy-x2F-replace-copy-if"><a href="#replace-copy-x2F-replace-copy-if" class="headerlink" title="replace_copy &#x2F; replace_copy_if"></a>replace_copy &#x2F; replace_copy_if</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/replace_copy.png" alt="alt text"> </p>
</li>
<li><p>replace_copy </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="built_in">replace</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 3 0 4 0 0 6</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>replace_copy_if</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">replace_if</span> (<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, is_even, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 2 3 0 5 0 0 6 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Removing"><a href="#Removing" class="headerlink" title="Removing"></a>Removing</h2><h3 id="remove-x2F-remove-if"><a href="#remove-x2F-remove-if" class="headerlink" title="remove &#x2F; remove_if"></a>remove &#x2F; remove_if</h3><ul>
<li><p>into<br>remove and remove_if only move the remaining elements to the front of the input range and don’t resize containers or deallocate memory.<br><img src="/2023/10/04/modifying-elements/remove.png" alt="alt text"></p>
</li>
<li><p>remove</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> re = <span class="built_in">remove</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">2</span>);</span><br><span class="line"><span class="comment">// one could re-use the remaining space...</span></span><br><span class="line"><span class="built_in">fill</span>(re, <span class="built_in">end</span>(v), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7 0 0 0</span></span><br><span class="line"><span class="comment">// ... or shrink the vector</span></span><br><span class="line">v.<span class="built_in">erase</span>(re, <span class="built_in">end</span>(v));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br></pre></td></tr></table></figure></li>
<li><p>remove_if</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> re = <span class="built_in">remove_if</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), is_even);</span><br><span class="line"><span class="comment">// one could re-use the remaining space...</span></span><br><span class="line"><span class="built_in">fill</span>(re, <span class="built_in">end</span>(v), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7 0 0 0</span></span><br><span class="line"><span class="comment">// ... or shrink the vector</span></span><br><span class="line">v.<span class="built_in">erase</span>(re, <span class="built_in">end</span>(v));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="remove-copy-x2F-remove-copy-if"><a href="#remove-copy-x2F-remove-copy-if" class="headerlink" title="remove_copy &#x2F; remove_copy_if"></a>remove_copy &#x2F; remove_copy_if</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/remove_copy.png" alt="alt text"></p>
</li>
<li><p>remove_copy</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(<span class="number">7</span>);</span><br><span class="line"><span class="keyword">auto</span> re = <span class="built_in">remove_copy</span>(<span class="built_in">begin</span>(in)+<span class="number">2</span>, <span class="built_in">begin</span>(in)+<span class="number">9</span>, <span class="built_in">begin</span>(out), <span class="number">2</span>);</span><br><span class="line"><span class="comment">// fit output vector</span></span><br><span class="line">out.<span class="built_in">erase</span>(re, <span class="built_in">end</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>remove_copy_if</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(<span class="number">7</span>);</span><br><span class="line"><span class="keyword">auto</span> re = <span class="built_in">remove_copy_if</span>(<span class="built_in">begin</span>(in)+<span class="number">2</span>, <span class="built_in">begin</span>(in)+<span class="number">9</span>, <span class="built_in">begin</span>(out), is_even);</span><br><span class="line"><span class="comment">// fit output vector</span></span><br><span class="line">out.<span class="built_in">erase</span>(re, <span class="built_in">end</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="unique-x2F-unique-copy"><a href="#unique-x2F-unique-copy" class="headerlink" title="unique &#x2F; unique_copy"></a>unique &#x2F; unique_copy</h3><ul>
<li><p>into<br>unique only moves the remaining elements to the front of the input range and does not resize containers or deallocate memory. If you want to also modify the containing object, you have to do it manually afterwards.<br><img src="/2023/10/04/modifying-elements/unique.png" alt="alt text"></p>
</li>
<li><p>unique</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">4</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> re = <span class="built_in">unique</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v));</span><br><span class="line"><span class="comment">// one could re-use the remaining space...</span></span><br><span class="line"><span class="built_in">fill</span>(re, <span class="built_in">end</span>(v), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 1 5 3 6 3 1 0 0 0 0</span></span><br><span class="line"><span class="comment">// ... or shrink the vector</span></span><br><span class="line">v.<span class="built_in">erase</span>(re, <span class="built_in">end</span>(v));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 1 5 3 6 3 1</span></span><br></pre></td></tr></table></figure></li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">4</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> rem = std::ranges::<span class="built_in">unique</span>(v);</span><br><span class="line"><span class="comment">// one could re-use the remaining space...</span></span><br><span class="line">std::ranges::<span class="built_in">fill</span>(rem, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 1 5 3 6 3 1 0 0 0 0</span></span><br><span class="line"><span class="comment">// ... or shrink the vector</span></span><br><span class="line">v.<span class="built_in">erase</span>(<span class="built_in">begin</span>(rem), <span class="built_in">end</span>(rem));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 1 5 3 6 3 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>unique_copy</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in &#123;<span class="number">4</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in.<span class="built_in">size</span>());</span><br><span class="line"><span class="keyword">auto</span> re = <span class="built_in">unique_copy</span>(<span class="built_in">begin</span>(in), <span class="built_in">end</span>(in), <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="comment">// fit output vector</span></span><br><span class="line">out.<span class="built_in">erase</span>(re, <span class="built_in">end</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 4 1 5 3 6 3 1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="erase-x2F-erase-if-c-20"><a href="#erase-x2F-erase-if-c-20" class="headerlink" title="erase &#x2F; erase_if (c++20)"></a>erase &#x2F; erase_if (c++20)</h3><ul>
<li><p>intro<br><img src="/2023/10/04/modifying-elements/erase.png" alt="alt text"></p>
</li>
<li><p>erase </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">erase</span>(v, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br><span class="line">std::deque&lt;<span class="type">int</span>&gt;  d &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">erase</span>(d, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : d) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br><span class="line">std::list&lt;<span class="type">int</span>&gt;   l &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">erase</span>(l, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : l) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>erase_if</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="type">const</span> is_even = [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> !(x &amp; <span class="number">1</span>); &#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">erase_if</span> (v, is_even);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br><span class="line">std::deque&lt;<span class="type">int</span>&gt; d &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">erase_if</span> (d, is_even);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : d) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br><span class="line">std::list&lt;<span class="type">int</span>&gt; l &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">erase_if</span> (l, is_even);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : l) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 3 5 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Sorted-Range-Operations"><a href="#Sorted-Range-Operations" class="headerlink" title="Sorted Range Operations"></a>Sorted Range Operations</h2><h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/merge.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in1 &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in2 &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit all elements</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in1.<span class="built_in">size</span>() + in2.<span class="built_in">size</span>());</span><br><span class="line"><span class="built_in">merge</span>(<span class="built_in">begin</span>(in1), <span class="built_in">end</span>(in1), <span class="built_in">begin</span>(in2), <span class="built_in">end</span>(in2), <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 1 2 3 4 5 6 7 8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in1 &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in2 &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// make sure output can fit all elements</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in1.<span class="built_in">size</span>() + in2.<span class="built_in">size</span>());</span><br><span class="line">std::ranges::<span class="built_in">merge</span>(in1, in2, <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 1 2 3 4 5 6 7 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="inplace-merge"><a href="#inplace-merge" class="headerlink" title="inplace_merge"></a>inplace_merge</h3><ul>
<li><p>into<br><img src="/2023/10/04/modifying-elements/inplace_merge.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="built_in">inplace_merge</span>(<span class="built_in">begin</span>(v), <span class="built_in">begin</span>(v)+<span class="number">5</span>, <span class="built_in">end</span>(v));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 1 2 3 3 4 5 6 8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::ranges::<span class="built_in">inplace_merge</span>(v, <span class="built_in">begin</span>(v)+<span class="number">5</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 1 2 3 3 4 5 6 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/std/algorithms.html">Hacking cpp Standard Library Algorithms</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2023/10/03/non-modifying-part3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/10/03/non-modifying-part3/" class="post-title-link" itemprop="url">STL - Non-Modifying Operations 下</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-03 09:13:14" itemprop="dateCreated datePublished" datetime="2023-10-03T09:13:14+08:00">2023-10-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-22 09:59:26" itemprop="dateModified" datetime="2024-08-22T09:59:26+08:00">2024-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Standard-Library-Algorithms/" itemprop="url" rel="index"><span itemprop="name">Standard Library Algorithms</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="STL - Non-Modifying Operations 下" href="/2023/10/03/non-modifying-part3/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::c6ae8d1bd652572288df157c90335988" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>328</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>A Simple Introduction to C++ Standard Library Algorithms: Non-Modifying Operations Topics.</p>
</blockquote>
<h2 id="Minimum-x2F-Maximum"><a href="#Minimum-x2F-Maximum" class="headerlink" title="Minimum &#x2F; Maximum"></a>Minimum &#x2F; Maximum</h2><h3 id="minmax"><a href="#minmax" class="headerlink" title="minmax"></a>minmax</h3><ul>
<li><p>intro<br><img src="/2023/10/03/non-modifying-part3/minmax.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> b = <span class="number">9</span>;</span><br><span class="line"><span class="keyword">auto</span> p = std::<span class="built_in">minmax</span>(a,b);  <span class="comment">// std::pair&lt;int,int&gt; p &#123;2,9&#125;</span></span><br><span class="line"><span class="keyword">auto</span> min = p.first;  <span class="comment">// int min = 2</span></span><br><span class="line"><span class="keyword">auto</span> max = p.second; <span class="comment">// int max = 9</span></span><br><span class="line"><span class="keyword">auto</span> [lo,hi] = std::<span class="built_in">minmax</span>(a,b);  <span class="comment">// int lo = 2, hi = 9  C++17</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="type">const</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="type">const</span> b = <span class="number">9</span>;</span><br><span class="line"><span class="keyword">auto</span> p = std::<span class="built_in">minmax</span>(&#123;<span class="number">3</span>,<span class="number">0</span>,b,<span class="number">3</span>,a,<span class="number">8</span>&#125;);  <span class="comment">// std::pair&lt;int,int&gt; p &#123;0,9&#125;</span></span><br><span class="line"><span class="keyword">auto</span> min = p.first;  <span class="comment">// int min = 0</span></span><br><span class="line"><span class="keyword">auto</span> max = p.second; <span class="comment">// int max = 9</span></span><br><span class="line"><span class="keyword">auto</span> [lo,hi] = std::<span class="built_in">minmax</span>(&#123;<span class="number">3</span>,<span class="number">0</span>,b,<span class="number">3</span>,a,<span class="number">8</span>&#125;);  <span class="comment">// int lo = 0, hi = 9  C++17</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">7</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> p = std::ranges::<span class="built_in">minmax</span>(v);  <span class="comment">// std::pair&lt;int,int&gt; p &#123;1,9&#125;</span></span><br><span class="line"><span class="keyword">auto</span> [min,max] = std::ranges::<span class="built_in">minmax</span>(v);</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123; <span class="type">int</span> q; <span class="type">char</span> c; &#125;;</span><br><span class="line">std::vector&lt;P&gt; <span class="type">const</span> w &#123;P&#123;<span class="number">3</span>,<span class="string">&#x27;a&#x27;</span>&#125;,P&#123;<span class="number">2</span>,<span class="string">&#x27;b&#x27;</span>&#125;,P&#123;<span class="number">1</span>,<span class="string">&#x27;c&#x27;</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">auto</span> [lo,hi] = std::ranges::<span class="built_in">minmax</span>(w, </span><br><span class="line">    [](P p1, P p2)&#123; <span class="keyword">return</span> p1.q &lt; p2.q; &#125;);  <span class="comment">// P lo &#123;1,&#x27;c&#x27;&#125;, hi &#123;3,&#x27;a&#x27;&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="clamp-c-17"><a href="#clamp-c-17" class="headerlink" title="clamp(c++17)"></a>clamp(c++17)</h3><ul>
<li><p>intro<br>if value &lt; lo, return lo; if value &gt; hi, return hi; return value, otherwise<br><img src="/2023/10/03/non-modifying-part3/clamp.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = std::<span class="built_in">clamp</span>( <span class="number">8</span>,  <span class="number">1</span>, <span class="number">5</span>);  <span class="comment">// int a =  5</span></span><br><span class="line"><span class="type">int</span> b = std::<span class="built_in">clamp</span>(<span class="number">-4</span>,  <span class="number">1</span>, <span class="number">5</span>);  <span class="comment">// int b =  1</span></span><br><span class="line"><span class="type">int</span> c = std::<span class="built_in">clamp</span>(<span class="number">-1</span>, <span class="number">-2</span>, <span class="number">5</span>);  <span class="comment">// int c = -1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="min-element"><a href="#min-element" class="headerlink" title="min_element"></a>min_element</h3><ul>
<li><p>intro<br><img src="/2023/10/03/non-modifying-part3/min_element.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">7</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// smallest in subrange (as shown in image):</span></span><br><span class="line"><span class="keyword">auto</span> i = <span class="built_in">min_element</span>(<span class="built_in">begin</span>(v)+<span class="number">2</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>);</span><br><span class="line"><span class="keyword">auto</span> min = *i;  <span class="comment">// int min = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// smallest in entire vector:</span></span><br><span class="line"><span class="keyword">auto</span> j = <span class="built_in">min_element</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v));</span><br><span class="line">std::cout &lt;&lt; *j;  <span class="comment">// prints &#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index of smallest:</span></span><br><span class="line"><span class="keyword">auto</span> argmin = <span class="built_in">distance</span>(<span class="built_in">begin</span>(v), j);  <span class="comment">// int argmin = 9</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">7</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> i = std::ranges::<span class="built_in">min_element</span>(v);</span><br><span class="line"><span class="keyword">auto</span> min = *i;  <span class="comment">// int min = 0</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="max-element"><a href="#max-element" class="headerlink" title="max_element"></a>max_element</h3><ul>
<li>intro<br><img src="/2023/10/03/non-modifying-part3/max_element.png" alt="alt text"></li>
</ul>
<h3 id="minmax-element"><a href="#minmax-element" class="headerlink" title="minmax_element"></a>minmax_element</h3><ul>
<li>intro<br><img src="/2023/10/03/non-modifying-part3/minmax_element.png" alt="alt text"></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/std/algorithms.html">Hacking cpp Standard Library Algorithms</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://gyhaoran.github.io/2023/10/02/non-modifying-part2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Leo Ge">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Leo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/10/02/non-modifying-part2/" class="post-title-link" itemprop="url">STL - Non-Modifying Operations 中</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-02 09:13:14" itemprop="dateCreated datePublished" datetime="2023-10-02T09:13:14+08:00">2023-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-22 09:59:20" itemprop="dateModified" datetime="2024-08-22T09:59:20+08:00">2024-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Standard-Library-Algorithms/" itemprop="url" rel="index"><span itemprop="name">Standard Library Algorithms</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="STL - Non-Modifying Operations 中" href="/2023/10/02/non-modifying-part2/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::a2097776581ada930e9337e3548a89d0" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>915</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>A Simple Introduction to C++ Standard Library Algorithms: Non-Modifying Operations Topics.</p>
</blockquote>
<h2 id="Comparing-Ranges"><a href="#Comparing-Ranges" class="headerlink" title="Comparing Ranges"></a>Comparing Ranges</h2><h3 id="equal"><a href="#equal" class="headerlink" title="equal"></a>equal</h3><ul>
<li><p>intro<br>uses <code>operator ==</code> for comparing elements; alternatively a custom <code>function(object)</code> can be passed as additional argument</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// true, if all elem in both range are equal</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(begin1, end1, begin2)</span></span>;       <span class="comment">// use  v1 == v2</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(begin1, end1, begin2, pred)</span></span>; <span class="comment">// use pred(v1, v2)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(begin1, end1, begin2, end2)</span></span>; <span class="comment">// c++14</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(begin1, end1, begin2, end2, pred)</span></span>; <span class="comment">// c++14</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ranges::equal</span><span class="params">(range1, range2)</span></span>;    <span class="comment">// c++20</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; r1 &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; r2 &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">equal</span>(<span class="built_in">begin</span>(r1), <span class="built_in">end</span>(r1), <span class="built_in">begin</span>(r2));  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// compare other subranges:</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">equal</span>(<span class="built_in">begin</span>(r1)+<span class="number">1</span>, <span class="built_in">begin</span>(r1)+<span class="number">7</span>, <span class="built_in">begin</span>(r2), <span class="built_in">begin</span>(r2)+<span class="number">6</span>);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// custom type</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span> &#123; <span class="type">int</span> x; <span class="type">char</span> q; &#125;;</span><br><span class="line">std::vector&lt;P&gt; a &#123; P&#123;<span class="number">1</span>,<span class="string">&#x27;n&#x27;</span>&#125;, P&#123;<span class="number">2</span>,<span class="string">&#x27;m&#x27;</span>&#125; &#125;;</span><br><span class="line">std::vector&lt;P&gt; b &#123; P&#123;<span class="number">1</span>,<span class="string">&#x27;y&#x27;</span>&#125;, P&#123;<span class="number">2</span>,<span class="string">&#x27;z&#x27;</span>&#125; &#125;;</span><br><span class="line"><span class="comment">// compare &#x27;P&#x27;s only by member &#x27;x&#x27;</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">equal</span>(<span class="built_in">begin</span>(a),<span class="built_in">end</span>(a), <span class="built_in">begin</span>(b),<span class="built_in">end</span>(b), </span><br><span class="line">              [](P p1, P p2) &#123; <span class="keyword">return</span> p1.x == p2.x; &#125; );  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; range1 &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; range2 &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; std::ranges::<span class="built_in">equal</span>(range1, range2);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="mismatch"><a href="#mismatch" class="headerlink" title="mismatch"></a>mismatch</h3><ul>
<li><p>intro<br>returns a std::pair of iterators to the first mismatching elements in 2 ranges<br>uses operator &#x3D;&#x3D; for comparing elements; alternatively a custom function(object) can be passed as additional argument</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">pair&lt;it1, it2&gt; <span class="title">mismatch</span><span class="params">(begin1, end1, begin2)</span></span>;</span><br><span class="line"><span class="function">pair&lt;it1, it2&gt; <span class="title">mismatch</span><span class="params">(begin1, end1, begin2, pred)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="function">pair&lt;it1, it2&gt; <span class="title">mismatch</span><span class="params">(begin1, end1, begin2, end2)</span></span>; <span class="comment">// c++14</span></span><br><span class="line"><span class="function">pair&lt;it1, it2&gt; <span class="title">mismatch</span><span class="params">(begin1, end1, begin2, end2, pred)</span></span>; <span class="comment">// c++14</span></span><br><span class="line"></span><br><span class="line"><span class="function">pair&lt;it1, it2&gt; <span class="title">mismatch</span><span class="params">(range1, range2)</span></span>;    <span class="comment">// c++20</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; r1 &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; r2 &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// compare subranges (as shown in image):</span></span><br><span class="line"><span class="keyword">auto</span> p = <span class="built_in">mismatch</span>(<span class="built_in">begin</span>(r1)+<span class="number">2</span>, <span class="built_in">begin</span>(r1)+<span class="number">9</span>, <span class="built_in">begin</span>(r2)+<span class="number">1</span>);</span><br><span class="line"><span class="comment">// != end-of-range ⇒ mismatch</span></span><br><span class="line"><span class="keyword">if</span> (p.first  != <span class="built_in">begin</span>(r1)+<span class="number">9</span>) &#123; <span class="keyword">auto</span> p1value = *p.first;  &#125;  <span class="comment">// 6</span></span><br><span class="line"><span class="keyword">if</span> (p.second != <span class="built_in">end</span>(r2))     &#123; <span class="keyword">auto</span> p2value = *p.second; &#125;  <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// compare entire containers:</span></span><br><span class="line"><span class="keyword">auto</span> q = <span class="built_in">mismatch</span>(<span class="built_in">begin</span>(r1), <span class="built_in">end</span>(r1), <span class="built_in">begin</span>(r2));</span><br><span class="line"><span class="keyword">if</span> (q.first != <span class="built_in">end</span>(r1)) &#123;</span><br><span class="line">  <span class="keyword">auto</span> q1value = *q.first;  <span class="comment">// 0</span></span><br><span class="line">  <span class="keyword">auto</span> q1index = <span class="built_in">distance</span>(<span class="built_in">begin</span>(r1), q.first);  <span class="comment">// 0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (q.second != <span class="built_in">end</span>(r2)) &#123;</span><br><span class="line">  <span class="keyword">auto</span> q2value = *q.second;  <span class="comment">// 1</span></span><br><span class="line">  <span class="keyword">auto</span> q2index = <span class="built_in">distance</span>(<span class="built_in">begin</span>(r2), q.second);  <span class="comment">// 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; range1 &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">3</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; range2 &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> [p1, p2] = std::ranges::<span class="built_in">mismatch</span>(range1, range2);</span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> value1 = *p1;  <span class="comment">// 6</span></span><br><span class="line"><span class="keyword">auto</span> <span class="type">const</span> value2 = *p2;  <span class="comment">// 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Binary-Search-of-Sorted-Ranges"><a href="#Binary-Search-of-Sorted-Ranges" class="headerlink" title="Binary Search of Sorted Ranges"></a>Binary Search of Sorted Ranges</h2><p>Searching one element in a sorted sequence of N elements can be done in O(log N) steps.<br>Finding an element in an unsorted sequence would take N steps in the worst case.</p>
<h3 id="binary-search"><a href="#binary-search" class="headerlink" title="binary_search"></a>binary_search</h3><ul>
<li><p>intro<br><img src="/2023/10/02/non-modifying-part2/binary_search.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// find in subrange (as shown in image):</span></span><br><span class="line"><span class="keyword">auto</span> i = <span class="built_in">lower_bound</span>(<span class="built_in">begin</span>(v)+<span class="number">3</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span> (i != <span class="built_in">end</span>(v)) &#123;  <span class="comment">// true ⇒ found</span></span><br><span class="line">  cout &lt;&lt; *i;  <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// find in entire vector</span></span><br><span class="line"><span class="keyword">auto</span> j = <span class="built_in">lower_bound</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (j != <span class="built_in">end</span>(v)) &#123;  <span class="comment">// true ⇒ found</span></span><br><span class="line">  cout &lt;&lt; *j;  <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> i = std::ranges::<span class="built_in">lower_bound</span>(v, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span> (i != <span class="built_in">end</span>(v)) &#123;  <span class="comment">// true ⇒ found</span></span><br><span class="line">  cout &lt;&lt; *i;  <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="lower-bound"><a href="#lower-bound" class="headerlink" title="lower_bound"></a>lower_bound</h3><ul>
<li><p>intro<br><img src="/2023/10/02/non-modifying-part2/lower_bound.png" alt="lower_bound"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// find in subrange (as shown in image):</span></span><br><span class="line"><span class="keyword">auto</span> i = <span class="built_in">lower_bound</span>(<span class="built_in">begin</span>(v)+<span class="number">3</span>, <span class="built_in">begin</span>(v)+<span class="number">7</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span> (i != <span class="built_in">end</span>(v)) &#123;  <span class="comment">// true ⇒ found</span></span><br><span class="line">  cout &lt;&lt; *i;  <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// find in entire vector</span></span><br><span class="line"><span class="keyword">auto</span> j = <span class="built_in">lower_bound</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (j != <span class="built_in">end</span>(v)) &#123;  <span class="comment">// true ⇒ found</span></span><br><span class="line">  cout &lt;&lt; *j;  <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> i = std::ranges::<span class="built_in">lower_bound</span>(v, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span> (i != <span class="built_in">end</span>(v)) &#123;  <span class="comment">// true ⇒ found</span></span><br><span class="line">  cout &lt;&lt; *i;  <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="upper-bound"><a href="#upper-bound" class="headerlink" title="upper_bound"></a>upper_bound</h3><ul>
<li>intro<br><img src="/2023/10/02/non-modifying-part2/upper_bound.png" alt="alt text"></li>
</ul>
<h3 id="equal-range"><a href="#equal-range" class="headerlink" title="equal_range"></a>equal_range</h3><ul>
<li><p>intro<br><img src="/2023/10/02/non-modifying-part2/equal_range.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// find in subrange (as shown in image):</span></span><br><span class="line"><span class="keyword">auto</span> r5 = <span class="built_in">equal_range</span>(<span class="built_in">begin</span>(v)+<span class="number">3</span>, <span class="built_in">begin</span>(v)+<span class="number">11</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// erase range of &#x27;5&#x27;</span></span><br><span class="line">v.<span class="built_in">erase</span>(r5.first, r5.second);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 1 2 3 4 6 6 7 7 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// find in entire vector</span></span><br><span class="line"><span class="keyword">auto</span> r6 = <span class="built_in">equal_range</span>(<span class="built_in">begin</span>(v), <span class="built_in">end</span>(v), <span class="number">6</span>);</span><br><span class="line"><span class="comment">// erase range of &#x27;6&#x27;</span></span><br><span class="line">v.<span class="built_in">erase</span>(r6.first, r6.second);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 1 1 2 3 4 7 7 8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; v &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> [r5b,r5e] = std::ranges::<span class="built_in">equal_range</span>(v, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// erase range</span></span><br><span class="line">v.<span class="built_in">erase</span>(r5b, r5e);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : v) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 3 4 6 6 7</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="includes"><a href="#includes" class="headerlink" title="includes"></a>includes</h3><ul>
<li><p>intro<br><img src="/2023/10/02/non-modifying-part2/includes.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; r1 &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; r2 &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line"><span class="comment">// as shown in image</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">includes</span>(<span class="built_in">begin</span>(r1), <span class="built_in">end</span>(r1), <span class="built_in">begin</span>(r2)+<span class="number">1</span>, <span class="built_in">begin</span>(r2)+<span class="number">5</span>);  <span class="comment">// true</span></span><br><span class="line"><span class="comment">// entire r2 in r1?</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">includes</span>(<span class="built_in">begin</span>(r1), <span class="built_in">end</span>(r1), <span class="built_in">begin</span>(r2), <span class="built_in">end</span>(r2));  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; range1 &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; range2 &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">cout &lt;&lt; std::ranges::<span class="built_in">includes</span>(range1, range2);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Merging"><a href="#Merging" class="headerlink" title="Merging"></a>Merging</h2><p>Two sorted sequences can be merged into one sorted sequence in linear time.</p>
<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><ul>
<li><p>intro<br><img src="/2023/10/02/non-modifying-part2/merge.png" alt="alt text"></p>
</li>
<li><p>example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in1 &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in2 &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// make sure output can fit all elements</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in1.<span class="built_in">size</span>() + in2.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="built_in">merge</span>(<span class="built_in">begin</span>(in1), <span class="built_in">end</span>(in1), <span class="built_in">begin</span>(in2), <span class="built_in">end</span>(in2), <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 1 2 3 4 5 6 7 8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>c++20</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; in1 &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; in2 &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// make sure output can fit all elements</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; out;</span><br><span class="line">out.<span class="built_in">resize</span>(in1.<span class="built_in">size</span>() + in2.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">std::ranges::<span class="built_in">merge</span>(in1, in2, <span class="built_in">begin</span>(out));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : out) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;  <span class="comment">// 0 1 2 3 4 5 6 7 8</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/std/algorithms.html">Hacking cpp Standard Library Algorithms</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Leo Ge</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">14k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">52 分钟</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>



<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("06/30/2023 11:03:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/gyhaoran" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cywKMio1u","appkey":"804af93d76e3f080dbb3d3ddaa361b28","count":true}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
